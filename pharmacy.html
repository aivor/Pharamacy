<!DOCTYPE html>
<html lang="en" class="has-navbar-fixed-top">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pharmacy | </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="bulma.css">
    <script src="js/jquery-3.4.1.slim.js"></script>
  </head>
  <body>
  <!--Navbar-->
  <nav class="navbar is-fixed-top box-shadow-y">
    <div class="navbar-brand">
        <a href="#" class="navbar-burger toggler">
            <span></span>
            <span></span>
            <span></span>
        </a>

        <a href="#" class="navabr-item has-text-weight-bold has-text-black"> Trust Pharmacy</a>
        <a href="#" class="navbar-burger nav-toggler">
            <span></span>
            <span></span>
            <span></span>
        </a>
    </div>
    <div class="navbar-menu has-background-white">
        <div class="navbar-start">
            <a href="#" class="navbar-item">
                 <i class="fas fa-home icon"> </i> Home
            </a>
            <a href="#" class="navbar-item"> Prescription </a>
        </div>
        <div class="navbar-end">
            <div class="navbar-item has-dropdown is-hoverable">
                <a href="#" class="navbar-link">Account</a>
                <div class="navbar-dropdown is-right">
                    <a href="#" class="navbar-item">Profile</a>
                    <a href="#" class="navbar-item">settings</a>
                    <hr class="navbar-divider">
                    <a href="#" class="navbar-item">Log out</a>
                </div>
            </div>
        </div>
    </div>

  </nav>
  <!--Navbar-->
  <div class="columns is-variable is-0">
    <div>
        <div class="menu-container px-1 has-background-white">
            <div class="menu-wrapper py-1">
                <aside class="menu">
                    <p class="menu-label">
                      General
                    </p>
                    <ul class="menu-list">
                      <li><a><i class="fas fa-tachometer-alt icon"></i> Dashboard</a></li>

                    </ul>
                    <p class="menu-label">
                      Administration
                    </p>
                    <ul class="menu-list">
                      <li><a>Team Settings</a></li>
                      <li>
                        <a class="is-active has-background-primary">Manage Your Team</a>
                        <ul>
                          <li><a>Members</a></li>
                          <li><a>Plugins</a></li>
                          <li><a>Add a member</a></li>
                        </ul>
                      </li>
                      <li><a>Invitations</a></li>
                      <li><a>Cloud Storage Environment Settings</a></li>
                      <li><a>Authentication</a></li>
                    </ul>
                    <p class="menu-label">
                      Transactions
                    </p>
                    <ul class="menu-list">
                      <li><a>Payments</a></li>
                      <li><a>Transfers</a></li>
                      <li><a>Balance</a></li>
                    </ul>
                  </aside>
            </div>
        </div>
    </div>
    <div class="column is-10-desktop is-offset-2-desktop is-9-tablet is-offset-3-tablet is-12-mobile">
      <div class="p-1">
        <div class="columns is-variable is-desktop">
          <div class="column">
            <h1 class="title">Dashboard</h1>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="js/jquery-3.4.1.js"></script>
  <script src="js/script.js"></script>
  <script src="js/jquery.nicescroll.min.js"></script>
  <script>
    //getting user token from localStorage
    var localToken = window.localStorage.getItem("access_token");
    console.log(localToken)
    // ajax calls to create drugs
    $.ajax({
      url: "https://virtual-healthcare.herokuapp.com/ap/pharmacy/add-drug",
      dataType: "json",
      method: "post",
      headers: {
        "Authorization" : `Bearer ${localToken}`
      },
      data: {
        drug_name: drug_name,
        quantity: quantity,
        price: price
      },
      success: function(res){
        console.log(res)
        if(res.drug){
          var drug_id = res.drug.id;
          $("#edit").click(function(e){
            e.preventDefault();
            // ajax calls to edit a dru
            $.ajax({
                  url: `https://virtual-healthcare.herokuapp.com/api/pharmacy/${drug_id}`,
                  method: "put",
                  data: {
                      drug_name: new_drug_name,
                      quantity: new_quantity
                  },
                  headers: {
                      "Authorization" : `Bearer ${localToken}`
                  },
                  success: function(res){
                      console.log(res)
                      if(res.drug){
                        $("#alert").text("drug has been edited")
                      }
                },
                  error: function(err){
                      console.log(err)
                    }
              })
          })
        }
      },
      error: function(err){
        console.log(err)
      }
    })

    // ajax calls to fetch all prescriptions
    $.ajax({
      url: "https://virtual-healthcare.herokuapp.com/api/pahrmacy/prescriptions",
      method: "get",
      success: function(res){
        console.log(res)
        if(res.data){
          var pres_id = res.data.id;
          $.ajax({
              url: `https://virtual-healthcare.herokuapp.com/api/pahrmacy/prescriptions/${pres_id}`,
              method: "get",
              success: function(res){
                  console.log(res)
                  if(res.data){
          
                  }
              },
              error: function(err){
                console.log(err)
              }
    })
        }
      },
      error: function(err){
        console.log(err)
      }
    })

    // Ajax calls to get all drugs
    
    $.ajax({
      url: "https://virtual-healthcare.herokuapp.com/api/pahrmacy/drugs",
      method: "get",
      success: function(res){
        console.log(res)
        if(res.data){
          console.log(res.data)
        }
      },
      error: function(err){
        console.log(err)
      }
    })
  </script>
  </body>
</html>